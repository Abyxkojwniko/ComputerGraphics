# Shadow Mapping

就是找到能够被光源看到，也能被摄像机看到的点

## Render from Light
![[Pasted image 20250819145535.png]]
从光源看向场景，记录能看到的所有的点的深度z_buffer
从眼睛看向场景，记录能看到的点投影回光源，记录在深度图的哪个像素上寻找这个点，然后比较该像素的深度，如果该深度相同，那么证明能够被看到
![[Pasted image 20250819145904.png]]

![[Pasted image 20250819145920.png]]
![[Pasted image 20250819145933.png]]
但是这里会有很多问题：
1、阴影图的像素应该设定为多大？
2、有些点太近了怎么办？

### 软阴影和硬阴影
![[Pasted image 20250819151057.png]]

完全看不到光源：本影
部分看到光源：半影

# Ray Tracing

光线追踪能够替代光栅化，但是非常非常慢，这是实时用于渲染的

## Basic Ray Tracing

按照3个基本假设进行
1.光是沿着直线传播的，但是有时候这是错误的
2.光线和光线不会发生碰撞，但是这仍然是错误的
3.光线是从光源发出然后经过一系列操作进入人的眼睛，这个路径是可以回溯的，也就是光路的可逆性

![[Pasted image 20250820153851.png]]
针对一个像素来说，这个像素会找到光线路径上最近的这个物体，然后看光源是否能照亮这个物体，然后算出这个点的颜色，写入这个像素
![[Pasted image 20250820161725.png]]
如果有弹射，那么在不同路径上显示的颜色为所有路径显示颜色的叠加，当然在光线追踪的后续中会有能量的衰减，这些都需要进行考虑
![[Pasted image 20250820162018.png]]
也就是说去找每个路径会经过的光的点，然后再反过去找到像素点的颜色

## Ray Equation

光线在数学上被定义为一个射线，也就是有一个起点和一个方向
![[Pasted image 20250820162405.png]]
![[Pasted image 20250820163357.png]]
求光线和球的交点：
![[Pasted image 20250820163456.png]]
推广：
![[Pasted image 20250820163601.png]]
如何做光线和三角形求交？![[Pasted image 20250820164044.png]]
可以一个一个三角形进行计算，但是非常慢
首先光线和平面求交点，然后判断点是否在三角形内
![[Pasted image 20250820165436.png]]
另一种更快的方法：
![[Pasted image 20250820170035.png]]

## Accelerating Ray Tracing Calculating

![[Pasted image 20250820170440.png]]
对于三维物体来说
![[Pasted image 20250820170552.png]]
那么在2D情况下，我们应该写一个交集
![[Pasted image 20250820170926.png]]
那么二维的设计如下，三维空间下，在所有的坐标下，都在内，出了任何一组坐标，都算离开
![[Pasted image 20250820171038.png]]
也就是进入三组对面时间的最大值，离开三组对面时间的最小值，但是我们也要检查进入的时间是否是负数

![[Pasted image 20250820171307.png]]

### Uniform Spatial Partitions

### Spatial Partitions
![[Pasted image 20250821145403.png]]
第一种：将空间包围起来，然后把空间切为8份，2，3维可以用，但是多维不行
第二种：每次划分分为两个区域，横竖交替，这样可以可以保证划分比较均匀
第三种：每次用任意一条线进行划分

#### KD-Tree
![[Pasted image 20250821150754.png]]
具体过程：
![[Pasted image 20250821151141.png]]
对于KD-Tree中，我们得知道三角形和哪些框有交集，这样比较麻烦，比如三角形包含了包围盒这种情况，所以最近几年不太使用KD-Tree


### BVH
并非划分两个空间，而是把物体分为两个部分，然后求两个部分三角形的包围盒
![[Pasted image 20250821153009.png]]
但是BoundingBox并不能划分开空间
然后可以继续进行下去
#### Build BVHs

![[Pasted image 20250821160722.png]]

![[Pasted image 20250821160848.png]]
### Spatial vs Object Partitions
![[Pasted image 20250821161035.png]]

## Basic radiometry


## 三维变换
- 与二维变换相同，同样都是先旋转然后再平移
- 同样平移的量需要一个额外的行和列来进行表示
- 旋转：
	- ![[Pasted image 20250710142959.png]]
- 对于旋转来说，找出一个固定轴，通过上述的3个矩阵进行不断变换，肯定最后可以得到最终的旋转
- 为什么绕y轴旋转是反的：因为y轴旋转沿着正方向走的方向看，它的方向不满足右手螺旋定则
## 罗德里格斯旋转公式推导

![[Pasted image 20250710144324.png]]
如果以这张图为例子，那么x方向就是vcosθ，右边的应该是sinθ(k×v)，k此时为单位向量
证明：
	因为(k×v)就等于|k|×|v|×sin<k,v>，因为kv垂直，k为单位向量，那么实际上就是v的模，右边变为vsinθ
	那么v是不变的，所以上面是成立的，因为直角三角形定理
![[Pasted image 20250710145847.png]]
为什么这公式是这样的？
![[Pasted image 20250710150703.png]]
将上面的值进行带入，那么可以得到最终结果
这里我们再详细地写一下证明过程：
![[Pasted image 20250710151931.png]]
![[Pasted image 20250710151915.png]]
那么还有一个小点要证明，那就是k×v和k×v的垂直分量最后相同，这是因为平行分量叉乘无意义
所以得到最终公式
![[Pasted image 20250710152022.png]]
#### 矩阵形式
![[Pasted image 20250710143553.png]]
![[Pasted image 20250710152637.png]]
这是因为中间括号中的结果是标量，所以可以进行交换，因为是一个行向量×一个列向量
最后结果变为
![[Pasted image 20250710152722.png]]
那么第二步叉乘：
叉乘可以转化为点乘，如下
![[Pasted image 20250710153318.png]]
![[Pasted image 20250710153357.png]]
那么写为点乘方式得到：
![[Pasted image 20250710153739.png]]同理可得到K×V可以得到：
![[Pasted image 20250710153930.png]]
那么得到最后的
![[Pasted image 20250710154148.png]]
那么这个公式就推理完成
对于该公式来说，这个旋转轴是过原点的，如果旋转轴不过原点，那么先平移到原点，然后再做旋转，最后平移回来即可。
![[Pasted image 20250710143553.png]]
后方的矩阵
# Viewing tranformation
## view/camera transformation

- 把三维空间中的物体变为二维空间中图片
	- model transformation
	- view transformation
	- projection transformation
	- mvp变换
- 首先相机位置：
- 向上方向就是相机平面的法向量方向，也就是旋转的方向
	- ![[Pasted image 20250711114518.png]]
- 视图变换如何变换
	- ![[Pasted image 20250711114559.png]]
	- ![[Pasted image 20250711114711.png]]
	- 直接相机不进行变换，而是物品进行反方向变换
	- ![[Pasted image 20250711114748.png]]
- 首先将相机放到标准坐标系上
	 - ![[Pasted image 20250711114957.png]]
- 数学上如何表示
	-  ![[Pasted image 20250711115012.png]]
	- 先做出平移然后再进行旋转，与标准到旋转不同
	- 但是这样不好找到原坐标，所以我们先找到标准到原位置的方法，然后求逆就可以得到愿到标准的矩阵，然后旋转矩阵是一个正交矩阵，所以旋转矩阵的逆就是其转置，所以这样就可以得到原位置到标准坐标的逆
	- 其他的物体也需要做相对应的变换
- 总结：求出反向旋转的矩阵然后求转置即可
# Projection transformation
## 投影
### 投影方式
![[Pasted image 20250711140935.png]]
这里是两种投影方式，左边的图是平行的，右边的延长会聚焦到一个点上，人眼成像更类似右边，也就是说明是否有近大远小的现象产生
![[Pasted image 20250711141250.png]]
- 正交投影：（或许更适合2d游戏）
	- 把对应的轴的参数去掉即可，类似工程制图，但是此时有一个问题，如何区分物体的正反面，移动到-1到1的矩形上方面后续计算。
	- 但是在实际操作中
	- ![[Pasted image 20250711141820.png]]
	- 描述这个立方体，这样x，y，z轴的范围就可以确定，然后进行标准化，也就是变为一个标准立方体，那么每个轴就应该会收缩
	- 这里z轴为什么是f，n。这是因为我们是沿着-z轴看东西，离得远的反而z更小，离得近的反而z更大
	- 数学投影：
		- ![[Pasted image 20250711143127.png]]
		- 先做平移将其放在原点上，然后进行缩放变为1×1×1的标准立方体，物体会拉伸，但是所有的变换变换完成后，还要再做一次拉伸，所以不会影响实际的效果
- 透视投影：
	- ![[Pasted image 20250711143531.png]]
	- 近大远小，平行线不再平行
	- ![[Pasted image 20250711144852.png]]
	- ![[Pasted image 20250711145248.png]]
	- 这里为什么远处大只是为了描述光线在透视中的表现，实际情况中远近一样大，然后再投影，那么远处投影下来就会变小
	- 首先要要将点往里挤，然后再做正交投影，那么挤如何做？
		- 首先近平面永远不变
		- 远平面的z不变，只在当前z位置进行变化收缩
		- 中心点不会改变
		![[Pasted image 20250711150229.png]]
	- 从侧面开始看，那么实际上就是一个相似三角形来确定在原平面应该收缩到什么位置
	- ![[Pasted image 20250711150642.png]]
	- 变化公式如图
	- 那么换为矩阵，就可以得到
	- ![[Pasted image 20250711150820.png]]
	- ![[Pasted image 20250711165648.png]]
	- 那么如何求得z呢，我们知道的只有在近平面和远平面上的z是不变的，所以这里可以采用特殊值法，第一个是远平面的中心点，第二个是近平面的点，上方图为近平面的点，这里可以列出方程
	- ![[Pasted image 20250711170227.png]]
	- 那么下方的公式就是远平面的中心点
	- ![[Pasted image 20250711170245.png]]
	- 求出A和B，那么透视投影的矩阵就可以得出了
- 问题：
	- 那么对于中间的任何一个z，这个点的z并不是线性变化的，变化后的z比原始的z更小，所以更靠近远平面
	证明：
	![[Pasted image 20250711173449.png]]
	![[Pasted image 20250711173458.png]]
	![[Pasted image 20250711173510.png]]
- 由于在做透视投影，向上方向沿着Y轴正向，相机摄像头朝向沿着-Z方向，所以n和f一定都是负数，所以表达式最后分母恒为非负，且分子为负数，所以表达式一定小于等于0，也就是Bz比Az小。意味着Bz在-Z方向上走的更远，也就是离近平面更远，离远平面更近。
- 用常识理解：
- ![[Pasted image 20250711173530.png]]